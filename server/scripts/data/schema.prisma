generator client {
  provider = "prisma-client-js"
  // Use the hidden .prisma client folder to avoid overwriting the @prisma/client package.
  // The public `@prisma/client` package will forward imports to this generated client.
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* ────────────────────────
   ENUMS
────────────────────────── */

enum OrderStatus {
  Pending
  Processing
  Shipped
  Delivered
  Cancelled
  Returned
}

enum AdminActionType {
  CreateProduct
  UpdateProduct
  DeleteProduct
  ManageUser
  RefundOrder
  Other
}

/* ────────────────────────
   MODELS
────────────────────────── */

model Users {
  userId            String              @id @default(uuid())
  fname             String
  lname             String
  phone             String              @unique
  email             String              @unique
  passwordHash      String
  isAdmin           Boolean             @default(false)
  createdAt         DateTime            @default(now())
  orders            Orders[]            @relation("UserOrders")
  shippingAddresses ShippingAddresses[]
  cart              Cart?
  adminActions      AdminActions[]
  orderSummary      OrderSummary?
}

model Products {
  productId         String              @id @default(uuid())
  name              String
  description       String?
  price             Decimal             @db.Decimal(10, 2)
  stock             Int
  createdAt         DateTime            @default(now())
  orderItems        OrderItems[]
  cartItems         CartItems[]
  productSummary    ProductSummary?
  productCategories ProductCategories[]
  imageUrl          String?
  rating            Float?
}

model Categories {
  categoryId        String              @id @default(uuid())
  name              String              @unique
  description       String?
  productCategories ProductCategories[]
  sellByCategory    SellByCategory?
}

model ProductCategories {
  productId  String
  categoryId String

  product   Products   @relation(fields: [productId], references: [productId])
  category  Categories @relation(fields: [categoryId], references: [categoryId])

  @@id([productId, categoryId])
}

model Orders {
  orderId           String              @id @default(uuid())
  userId            String
  shippingAddressId String?
  status            OrderStatus         @default(Pending)
  totalPrice        Decimal             @db.Decimal(10, 2)
  createdAt         DateTime            @default(now())

  user              Users?               @relation("UserOrders", fields: [userId], references: [userId], onDelete: Cascade)
  shippingAddress   ShippingAddresses?  @relation(fields: [shippingAddressId], references: [shippingAddressId])
  orderItems        OrderItems[]
}

model OrderItems {
  orderItemId String    @id @default(uuid())
  orderId     String
  productId   String
  quantity    Int
  price       Decimal   @db.Decimal(10, 2)

  order       Orders    @relation(fields: [orderId], references: [orderId])
  product     Products  @relation(fields: [productId], references: [productId])
}

model Cart {
  cartId     String      @id @default(uuid())
  userId     String      @unique
  createdAt  DateTime    @default(now())

  user       Users       @relation(fields: [userId], references: [userId])
  cartItems  CartItems[]
}

model CartItems {
  cartItemId String    @id @default(uuid())
  cartId     String
  productId  String
  quantity   Int

  cart       Cart      @relation(fields: [cartId], references: [cartId])
  product    Products  @relation(fields: [productId], references: [productId])
}

model ShippingAddresses {
  shippingAddressId String   @id @default(uuid())
  userId            String
  city              String
  state             String
  zipCode           String
  country           String
  createdAt         DateTime @default(now())

  user              Users?    @relation(fields: [userId], references: [userId])
  orders            Orders[]
}

model AdminActions {
  adminActionId String          @id @default(uuid())
  adminId       String
  actionType    AdminActionType
  details       String?
  createdAt     DateTime        @default(now())

  admin         Users           @relation(fields: [adminId], references: [userId])
}

model OrderSummary {
  orderSummaryId  String    @id @default(uuid())
  userId          String    @unique
  totalOrders     Int       @default(0)
  totalSpent      Decimal   @default(0.00) @db.Decimal(15, 2)
  lastOrderDate   DateTime?
  createdAt       DateTime  @default(now())

  user            Users     @relation(fields: [userId], references: [userId])
}

model ProductSummary {
  productSummaryId String    @id @default(uuid())
  productId        String    @unique
  totalSold        Int       @default(0)
  totalRevenue     Decimal   @default(0.00) @db.Decimal(15, 2)
  lastSoldDate     DateTime?
  createdAt        DateTime  @default(now())

  product          Products  @relation(fields: [productId], references: [productId])
}

model SellSummary {
  sellSummaryId       String   @id @default(uuid())
  totalRevenue        Decimal  @default(0.00) @db.Decimal(15, 2)
  totalOrders         Int      @default(0)
  totalProductsSold   Int      @default(0)
  startDate           DateTime
  endDate             DateTime
  createdAt           DateTime @default(now())
}

model SellByCategory {
  sellByCategoryId    String     @id @default(uuid())
  categoryId          String     @unique
  totalRevenue        Decimal    @default(0.00) @db.Decimal(15, 2)
  totalProductsSold   Int        @default(0)
  lastSoldDate        DateTime?
  createdAt           DateTime   @default(now())

  category            Categories @relation(fields: [categoryId], references: [categoryId])
}
