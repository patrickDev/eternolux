# Migration Files - Complete Guide

## ðŸ“¦ 4 Migration Files Provided

1. **migration.sql** - Main schema (8 tables)
2. **sessions_migration.sql** - Sessions table for auth
3. **seed.sql** - Sample test data
4. **rollback.sql** - Undo all migrations

---

## ðŸš€ Quick Setup

### Step 1: Copy Files to Your Project
```bash
# Create migrations folder
mkdir -p migrations

# Copy all migration files
cp migration.sql migrations/
cp sessions_migration.sql migrations/
cp seed.sql migrations/
cp rollback.sql migrations/
```

### Step 2: Run Migrations
```bash
# Create all tables (8 tables)
turso db shell eternolux-dev < migrations/migration.sql

# Add sessions table
turso db shell eternolux-dev < migrations/sessions_migration.sql

# (Optional) Add test data
turso db shell eternolux-dev < migrations/seed.sql
```

---

## ðŸ“‹ What Each File Does

### 1. migration.sql (Main Schema)
Creates **8 tables**:
- âœ… `users` - User accounts
- âœ… `addresses` - User addresses
- âœ… `products` - Product catalog
- âœ… `cart_items` - Shopping cart
- âœ… `orders` - Orders
- âœ… `order_items` - Order line items
- âœ… `reviews` - Product reviews
- âœ… `wishlist` - User wishlists

**Command**:
```bash
turso db shell eternolux-dev < migrations/migration.sql
```

---

### 2. sessions_migration.sql (Auth Sessions)
Creates **1 table**:
- âœ… `sessions` - Authentication sessions

**Command**:
```bash
turso db shell eternolux-dev < migrations/sessions_migration.sql
```

---

### 3. seed.sql (Test Data)
Inserts sample data:
- âœ… 2 test users (admin + regular user)
- âœ… 10+ sample products
- âœ… Sample addresses
- âœ… Sample reviews

**Command**:
```bash
turso db shell eternolux-dev < migrations/seed.sql
```

**Test credentials**:
- Admin: `admin@eternolux.com` / password: `AdminPass123`
- User: `john.doe@example.com` / password: `UserPass123`

---

### 4. rollback.sql (Undo Migrations)
Drops all tables (for fresh start)

**Command**:
```bash
turso db shell eternolux-dev < migrations/rollback.sql
```

âš ï¸ **Warning**: This deletes ALL data!

---

## âœ… Complete Setup Workflow

```bash
# 1. Create migrations folder
mkdir -p migrations

# 2. Copy files
cp migration.sql sessions_migration.sql seed.sql rollback.sql migrations/

# 3. Run main migration
turso db shell eternolux-dev < migrations/migration.sql

# 4. Add sessions
turso db shell eternolux-dev < migrations/sessions_migration.sql

# 5. Add test data (optional)
turso db shell eternolux-dev < migrations/seed.sql

# 6. Verify tables created
turso db shell eternolux-dev ".tables"
```

**Expected output**:
```
addresses        orders           reviews          
cart_items       order_items      sessions         
products         users            wishlist
```

---

## ðŸ§ª Test the Database

```bash
# Connect to database
turso db shell eternolux-dev

# List all tables
.tables

# Check users table
SELECT * FROM users;

# Check products
SELECT product_id, name, price FROM products LIMIT 5;

# Exit
.quit
```

---

## ðŸ”„ Reset Database (Fresh Start)

If you need to start over:

```bash
# 1. Drop all tables
turso db shell eternolux-dev < migrations/rollback.sql

# 2. Recreate tables
turso db shell eternolux-dev < migrations/migration.sql
turso db shell eternolux-dev < migrations/sessions_migration.sql

# 3. Add test data
turso db shell eternolux-dev < migrations/seed.sql
```

---

## ðŸ“Š Database Schema Summary

After running migrations, you'll have **9 tables** with **all relationships**:

```
users (1) â”€â”€â”€â”€â”€< addresses (many)
users (1) â”€â”€â”€â”€â”€< cart_items (many)
users (1) â”€â”€â”€â”€â”€< orders (many)
users (1) â”€â”€â”€â”€â”€< reviews (many)
users (1) â”€â”€â”€â”€â”€< wishlist (many)
users (1) â”€â”€â”€â”€â”€< sessions (many)

products (1) â”€â”€< cart_items (many)
products (1) â”€â”€< order_items (many)
products (1) â”€â”€< reviews (many)
products (1) â”€â”€< wishlist (many)

orders (1) â”€â”€â”€â”€< order_items (many)
```

---

## ðŸŽ¯ Next Steps

After migrations:

1. âœ… Update `.dev.vars` with database URL
2. âœ… Test backend with `npm run dev`
3. âœ… Test registration endpoint
4. âœ… Test login endpoint
5. âœ… Deploy to Cloudflare

---

## ðŸ”§ Troubleshooting

### Error: "database not found"
```bash
# Create database first
turso db create eternolux-dev
```

### Error: "table already exists"
```bash
# Tables already created, skip migration or rollback first
turso db shell eternolux-dev < migrations/rollback.sql
```

### Want to see what's inside a migration?
```bash
cat migrations/migration.sql
```

### Check if migrations ran successfully
```bash
turso db shell eternolux-dev "SELECT name FROM sqlite_master WHERE type='table';"
```

---

## ðŸ“ Migration Files Location

```
your-project/
â””â”€â”€ migrations/
    â”œâ”€â”€ migration.sql           âœ… Main schema (8 tables)
    â”œâ”€â”€ sessions_migration.sql  âœ… Sessions table
    â”œâ”€â”€ seed.sql                âœ… Test data
    â””â”€â”€ rollback.sql            âœ… Drop all tables
```

---

**All files are ready in your outputs folder!** Just copy and run. ðŸš€